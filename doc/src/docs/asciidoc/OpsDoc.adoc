= Ops Car Progress
J. Scott Walton
:description: documentation for the Ops Car program
:imagesdir: ./images

== Introduction

The Ops Car Progress program is a tool to record (in a database)
by running it at intervals as trains are moved by the JMRI OpsPro
program. The Ops Car Progress program (hereafter referred to as
OpsCar) reads the JMRI OpsPro files and read them in the database.
The next time the programd is run, it will record the location of
cars at that point. You can then look at the position of each car
at each of the two points. Or, you can look at which cars at
each location. Each execution of the OpCar program will create
another set of records of cars and locations. Ideally, you would
run the OpsCar program each tie you terminate a train in JMRI OpsPro.
That would give you a way to track the movement of cars to ensure
that the cars are moving the way you want them.

When first run the program there are a number of fields 
that you must fill out before you can actually collect data.
Several of the fields (Userid, password and Schema) are items
that you simply pick a value for, enter them, and then, 
once the program uses them, they are fixed.
One value (Operations Home) depends on where JMRI profile 
operations director is located.
Only the database information is complex and there are
sam

== Installation

There is no automatic installation process. Simply extract the files
contained in the distribution zip into an empty folder.
On Windows, this should *not* be in
the Windows "Program Files" folder 
(Windows makes this Read Only and the program 
needs to write a log file to record what it has done.
Change to the "bin" folder inside the resulting structure and
execute either the "Ops_pro_car_progress.bat" or the
"Ops_pro_car_progress" depending on your operating system
(.bat for Windows, the other for Unix or Mac).

This program requires Java, at least at version 11, but supports up
to Java 21. This is the same as the JMRI requirement.

There are several values that must be entered the first time you
run the program. When you run the program for the first time, you
will see the following dialog. The various fields must be filled in
and saved before you can continue (unless you exit).

image::Empty_dialog.png[Initial empty dialog]

== The Setup Dialog

=== The fields in the Dialog

image::Annotated_Save_dialog.png[Dialog with pointers]

==== Userid

The Userid field (labeled "A" in the image above) will become the userid
for the database. 
This first time you connect to the database, this will become
the password, so it can be anything you want.
If you won't be interacting with database except through
this application, this field is not that important, but it must have a value.
You can use any value you want, but it should start with a letter, consist
of letters, numbers and perhaps an underscore. There is no specific length
requirement, but you should keep it relatively short. If you will be
interacting with the database with another tool, you should keep track of
this (and the following) values.

==== Password

The password field ("B" above) is another required field. This value
is case dependent. The information will be shown as asterisks as you
enter it.

WARNING: This field is stored in unencrypted form! Do not use the
password from any other system here. There is no security risk with
this password since the data is not financially important and the database
will be not be shared on the intern

==== Schema

Another required field (labeled "C"). It should start with a letter and
contain only letters, numbers, and possibly underscores. This will
be used to qualify the data in the database.

==== Operations Home

The location of the OpsPro data. Either enter it in the field labeled "D",
or use the the "Select Operations Home" button to find the correct
location.

An easy way to find this directory is to use JMRI to 
show you the location. In PanelPro or DecoderPro, open the
Help menu drop-down. 
Choose the "File Locations" menu choice. This will
open a panel like the following:

image::File_Locations.png[File locations dialog]

In this dialog, click on the "Open Profile Location" and you will see an Operating System window showing the contents of
the JMRI Profile folder. One of the folders shown should be
the "operations" diretory. This is the location you want.
Double click on that folder. You should now be looking
at the contents of that directory. Copy the address 
of the location from the path at the top of the 
explorer window. Paste that into the Operations Home field.


If you use the "Select Operations Home" button, it will open
a java File Browser. If your profile is located in a 
custom location, you should navigate to that profile 
directory and select the folder named "operations"

Your home directory will contain a 
directory which contains JMRI profiles (unless they are
placed in a custom location). In Windows, this folder is
named "JMRI", but in UNIX and Mac, it's called ".jmri" 
which marks it as a "hidden" folder. Drill down into this
folder and you should see the various JMRI profiles. 
Choose the directory named for your operations profile.
When you drill down into that folder, you should see
the "operations" folder. This is the location you want. 
Select that and click the Okay button. That will place 
that directory name into the field.

==== Database URL

This is most difficult field, yet also the easiest, beacuase
there several rules that determine the structure. There are
several parts to the URL:

. "jdbc:h2:" -- specifying the use of Java and H2 (the database).
. "file:" -- the URL will contain the location of the database.
. The location -- On Windows, this must be a fully qualified
path  - thus it must start with a a drive letter.
On Unix and Mac it can start with your home folder ("~").
. "/" - a seperator
. database -- the name of the database
. ";" (optional, if nothing follows" -- a seperator
. "AUTO_SERVER=TRUE:" -- (optional, but reccomended) specifies that another program can also use the database at the same time.

On Windows, the location can use either a Windows style 
path seperator ("\") or a Unix style ("/"), or both. 
You can also use "~" as the Windows user home directory.

===== Examples

====== Windows

* jdbc:h2:file:C:\Projects\decodder3/testing/testdb;;AUTO_SERVER=TRUE;

* jdbc:h2:file:/C/Projects\decodder3/testing/testdb;;AUTO_SERVER=TRUE;

* jdbc:h2:file:~\decodder3/testing/testdb;;AUTO_SERVER=TRUE;

====== Unix

* yet to come

=== Completing the settings

When all the values have been filled in, the Save button
will be enabled. Click on that button. If there are
are any problems with any of the values, you shold
see a message telling you where the problem lies.
If all the values are good, the Save button will be disabled
and all the fields will be locked. If you really want
to change values again, you will need to click on the
"Enable reentry of settings" button and click "Okay" 
that you really want to do that.

=== The Run Identifier Field

The Run Identifier label a set of values in the database. 
This is "1" in the diagram above. Use this value
to identify a series of Operations Pro movements you have 
made in JMRI. This field needs to be non-blank, but it
can be as simple as "A" or "B". Once this field is 
non-blank, the "Collect" button will be enabled.

The contents of the "Run Comment" field will be recorded
each time you "Collect" data. Use that to identify what
happened between collections.

Once the Run Identifier has a value, the "Sequence" will
show the number of times you have pressed the Collect
button. If this number is greater than zero, the 
"View" button will be enabled. 
The sequence nuber will be the number columns you will
see when you view the data.

== Using the program

Press the "Collect" button to read the first set of
data from the OpsPro data. Then, in OpsPro, 
build a train. Though it will work to "Move" the 
train to the its first stop, I reccomend that you 
"Terminate" the train. This basically moves it 
through all of its stops. Now press the "Collect" 
button again. You now have 2 sets of data collected and
the "View" button will be enabled. When you click
the View button you will see a dialog with
many options allowing you to view car or by location.
It will also give you many options to filter the 
data.

image::View_dialog.png[The options to view the data]

If you select "By Car", you have several options to filter
the view. Click on "View Data" to a table listing cars 
(with their Road Name, Road Number and type of car) 
listed down the left. Each column, labeled with the 
sequence number (the order in which the data was collected), 
contains the location, track and Load (type of load, or 
empty).

Notice that, if the "Moved" radio button is disabled it is
because no cars moved between the various collections. 
This might be because there was only one collection. 

The View looks like the following:

image::View_results.png[The data collected]

You can sort the data by Car Number or Car Type by 
clicking on the "Car/Type" header of the column. Which
you sort by depends on the setting of the "Sort By" button,
which can be "By Type" or "By Car". Clicking again reverses
the sort order.

Filter the data by selecting more specific options. 
One of the most useful might be the "Moved" option:
This shows only those cars that moved over the course of 
the data collections. If you are devoloping your 
OpsPro paramenters to move certain cars or loads, you
might want to filter to show only that data.


Selecting the "By Location" brings up a slightly 
different view, showing the locations and which cars
occupy them:

image::View_Results_byLocation.png[View of data by location]

This time, the Load/Empty is shown with the location. 
Locations with no cars show an blank field. Some
locations may have *many* cars.

== Usage Scenarios

=== Developing Custom Load Movements

Suppose you are interested in getting LOads and Empties
moving better by using custom loads at certain
desitinations, but you aren't sure about the best
way to do that. This program can help you investigate
and compare the alternatives. Decide where you 
will be using those custom loads, and which trains
will be involved in moving those loads and empties.

Start by making a complete backup of the OpsPro data. 
When you do that, OpsPro will ask you to enter
an identication for that backup, suggesting a time/date
and letting you add something to it or change it.
Use Operations Pro, Settings, Backup to do that. Now
you have a starting point to which you can return
after each set of trials. Make the to add custom 
loads and empties at the appropriate points.

Use the Run Identification to seperate the different
trials. Each time you view the data, you will only see
things happen within the data for that Run Identification.
Thus you are starting from clean slate when you change 
the Run Identification.

Once you have changed the Run Identification, press the 
Collect button and collect the first set of data. Next 
Build and then Terminate the first train that you have
determined will be involved. Now press the Collect button
again. You now have the first set of data points. Continue
with each train with the Build, Terminate and COllect process.
Now you can see the effect of those changes you made to
add the custom loads. You may find that the View of 
"Moved" gets you quickly to see the effect of the loads and
empties.

To see the effect of a implementing the loads and empties
differently you need to switch to a different Run Identification.
Also, you need to restore the OpsPro data from the backup 
you made earlier.
OpsPro Settings Restore will show you list of backups you
have made and let you select the one you want. 

You now have reset OpsPro back to orginial conditions.
Make your new changes to loads and empties and their 
destinations and Collect the intial cars and locations.

Run through the trains in the same manner you did earlier.
Build, Terminate and Collect. Now you can see 
how the cars have moved through the cycle.

If you want to see how the earlier run went, you can
change the Run Identification and View the data again.
If you want to compare them, you can use screen shots.
The programs doesn't (yet) provide a way the print the 
data.



