<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spw.mappers.MapperInterface">
    <select id="selectRunId" resultType="RunId">
        select
            id,
            runid,
            comments as comment,
            seqNum as sequenceNumber
        from RunIds where runId = #{runid}
    </select>
    <update id="updateRunId" parameterType="RunId">
        update runids
            set comments = #{comment},
            seqNum = #{sequenceNumber}
        where runid = #{runid}
    </update>
    <insert id="insertRunId" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO runids
            (
                RunId,
                comments,
                seqNum
            )
        VALUES
            (
                #{runid},
                #{comment},
                #{sequenceNumber}
        )
    </insert>
    <select id="getSequenceMax">
        SELECT
            COALESCE(MAX(Seq_num), 0)
        FROM
            run_locs
        WHERE
            runId = #{runId}
    </select>
    <update id="mergeCar">
        MERGE
            INTO
            cars ( carid, roadname, roadnumber, runid, carLoad )
        KEY ( runId, CarId) VALUES
        (
        #{carId},
        #{roadName},
        #{roadNumber},
        #{runId},
        #{carLoad}
        )
    </update>
    <insert id="insertRunLoc">
        INSERT INTO run_locs
            (
                runId,
                seq_num,
                carId,
                trkId,
                load
            )

        VALUES (
                #{runId},
                #{seqNum},
                #{carId},
                #{trkId},
                #{load}
            )
    </insert>
    <select id="getTrack">
        SELECT
            id,
            runId,
            trkId,
            parentId,
            parentXmlId,
            trkName,
            trackType,
            trkLength
        FROM
            tracks
        WHERE
            runid = #{runId}
        AND trkId = #{trkId}
    </select>
    <update id="updateTrack">
        UPDATE
            tracks
        SET
            parentId = #{parentId},
            parentXmlId = #{parentXmlId},
            trkName = #{trkName},
            trackType = #{trackType},
            trkLength = #{trkLength}
        WHERE
            id = #{id} ;

    </update>
    <insert id="insertTrack" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tracks
            (
                runId,
                trkId,
                parentId,
                parentXmlId,
                trkName,
                trackType,
                trkLength
            ) VALUES (
                #{runId},
                #{trkId},
                #{parentId},
                #{parentXmlId},
                #{trkName},
                #{trackType},
                #{trkLength}
            )
    </insert>
    <insert id="insertLocation" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO locations
             (
                runId,
                xmlid,
                name
            )  VALUES (
                #{runId},
                #{xmlId},
                #{name}
            )
    </insert>
    <select id="getLocation" parameterType="Location">
        SELECT
            id,
            runid,
            xmlid,
            name
        FROM
            locations
        WHERE
            runid = #{runId}
        AND xmlid = #{xmlId}
    </select>
</mapper>